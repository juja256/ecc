# Комп'ютерний практикум #2: Реалізація класичних криптосистем на базі еліптичних кривих

## Мета лабораторної роботи
Отримання практичних навичок програмної реалізації класичних криптосистем на базі еліптичних кривих, закріплення
теоретичного матеріалу, отриманого на лекційних заняттях.

## Теоретичний матеріал

### Ключовий обмін Діффі-Геллмана на еліптичних кривих

Розглянемо модифікацію класичного протоколу Діффі-Геллмана з використанням групи точок еліптичної кривої замість мультиплікативної групи простого поля.

**Параметри протоколу**

В якості параметрів протоколу ключового обміну сторони(Аліса та Боб) мають узгодити еліптичну криву $E \colon y^2 = x^3 + ax + b$, тобто всі її коефіціенти $a,b$, порядок простої циклічної групи точок - $n$ та базову точку $P$.

**Ключовий обмін**
| Аліса | Боб |
| ----- | --- |
| генерує $d_A \in_R \{2,..., n\}$   | генерує $d_B \in_R \{2,..., n\}$  |
| $Q_A=d_AP\quad \longrightarrow $  |  |
|    | $\longleftarrow\quad Q_B=d_BP $       |
| $S = d_AQ_B = d_Ad_BP$   | $S = d_BQ_A = d_Bd_AP$       |

Як бачимо, сторони отримали ту-ж саму точку $S$. В якості спільного секрету можна взяти x-координату точки $S$.

### Направлене шифрування на базі еліптичних кривих

Розглянемо протокол направленого шифрування на базі еліптичних кривих: Аліса має відкритий ключ Боба та хоче зашифрувати повідомлення $M$. 

**Генерація ключів**

На початку Боб повинен обрати параметри: еліптичну криву $E \colon y^2 = x^3 + ax + b$, тобто всі її коефіціенти $a,b$, порядок простої циклічної групи точок &ndash; $n$ та базову точку $P$.

Далі згідно з обраними параметрами Боб генерує закритий ключ $d_B \in_R \{2,..., n\}$ та обчислює відкритий ключ $Q_B=d_BP$, який він публікує у відкритий доступ разом з обраними параметрами.

**Зашифрування**

1. Для того щоб зашифрувати повідомлення $M$ Аліса має обрати алгоритм симетричного шифрування: $Enc$ (розшифрування відповідно &ndash; $Dec$) та інкапсуляції ключа &ndash; $Wrap$(декапсуляції відповідно &ndash; $Unwrap$). 

2. Аліса генерує випадковий симетричний ключ $k$ та за допомогою *Enc* шифрує повідомлення $C_M = Enc(M, k)$

3. Далі Аліса генерує *ефемерну ключову* пару: $(e_A, Q_A) \colon e_A\in_R \{2,..., n\},\ Q_A=e_AP$. 

4. Аліса згідно протоколу Діффі-Геллмана обчислює спільний секрет між своєю ефемерною парою $(e_A, Q_A)$ та відкритим ключем Боба $Q_B$: $S=(S_x, S_y)=e_AQ_B=e_Ad_BP$

5. Аліса інкапсулює симетричний ключ $k$ отриманим спільним секретом $S_x$: $C_k = Wrap(k, S_x)$

6. Аліса надсилає защифрований конверт Бобу: $Env = (Q_A, C_k, C_M)$

**Розшифрування**

1. Боб отримує повідомлення $Env$

2. Боб, використовуючи протокол Діффі-Геллмана між своїм закритим ключем та ефемерним ключем Аліси, виводить спільний секрет: $S=(S_x, S_y)=d_BQ_A=d_Be_AP$

3. Боб декапсулює ключ шифрування повідомлення: $k = Unwrap(C_k, S)$

4. Боб розшифровує зашифроване повідомлення: $M = Dec(C_M, k)$

### Цифровий підпис на базі еліптичних кривих

Розглянемо протокол цифрового підпису на базі алгоритму *ECDSA*, що використовує схему Ель-Гамаля. Аліса підписує довільне повідомлення $M$. Боб перевіряє підпис Аліси.

**Генерація ключів**

На початку Аліса повинна обрати параметри: еліптичну криву $E \colon y^2 = x^3 + ax + b$, тобто всі її коефіціенти $a,b$, порядок простої циклічної групи точок &ndash; $n$ та базову точку $P$, а також деяку (криптографічну) геш-функцію $H$.

Далі згідно з обраними параметрами Аліса генерує закритий ключ $d_A \in_R \{2,..., n\}$ та обчислює відкритий ключ $Q_A=d_AP$, який вона публікує у відкритий доступ разом з обраними параметрами.

**Підпис**

1. Аліса обчислює значення геш-функції від повідомлення: $h=H(M)$
2. Аліса вибирає деяке випадкове число $k \in_R \{2,..., n\}$ та обчислює $kP = (x_1, y_1);\ r=x_1 \bmod n$
3. Якщо $r=0$ &ndash; повернутись до кроку 1, інкаше обчислити $s=k^{-1}(h + d_Ar) \bmod n$.
4. В якості цифрового підпису повідомлення $M$ Аліса публікує пару чисел $(r,s)$

**Перевірка**

1. Боб отримує підписане повідомлення $M$, підпис $(r,s)$ та відкритий ключ Аліси $Q_A$
2. Боб обчислює $h=H(M)$
3. Боб обчислює $u_1 = s^{-1}h \bmod n,\ u_2 = s^{-1}r \bmod n$
4. Боб обчислює $u_1P+u_2Q_A=(x_0, y_0),\ v = x_0 \bmod n$
5. Якщо $v=r$ &ndash; підпис вірний, інакше &ndash; не вірний.
## Завдання

Згідно свого варіанту:

1. Реалізувати схему ключового обміну Діффі-Геллмана на еліптичних кривих та перевірити коретність узгодження спільного секрету.
2. Реалізувати алгоритм направленого шифрування на базі ефемерного ключового обміну Діффі-Геллмана на еліптичних кривих та перевірити коректність, зашифрувавши довільне повідомлення. В якості симетричного шифру $Enc$ та алгоритму інкапсуляції $Wrap$ можна застосувати звичайний *XOR*-шифр: $C_i = M_i \oplus K$, де довжина блоку: $|M_i|=|C_i|=|K|$ або ж можна використати *AES*, якщо ви &ndash; перфекціоніст :)
3. Реалізувати схему цифрового підпису згідно алгоритму *ECDSA* та перевірити коректність: підписати довільний байтовий рядок, а згодом перевірити підпис. В ролі геш-функції $H$ можна взяти, наприклад, готову реалізацію *SHA256* або *SHA3*.

| Варіант      | Еліптична крива |
| ----------- | ----------- |
| 1   | P-192       |
| 2   | P-224       |
| 3   | P-256       |
| 4   | P-384       |
| 5   | P-519       |
| 6 `*`  | [Ed25519](https://datatracker.ietf.org/doc/html/rfc8032)     |
| 7 `*`  | [BabyJubJub](https://docs.iden3.io/publications/pdfs/Baby-Jubjub.pdf)  |

> `*` означає додаткові завдання, які не обов'язкові до виконання, але можуть принести додаткові бали до рейтингу

## Рекомендована література
1. Д. Кнут. Искусство программирования на ЭВМ. Т.2. – М.:Мир, 1976. –724 с.
2. https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.202.2977&rep=rep1&type=pdf
3. https://nvlpubs.nist.gov/nistpubs/fips/nist.fips.186-4.pdf
4. https://www.cs.miami.edu/home/burt/learning/Csc609.142/ecdsa-cert.pdf
5. https://datatracker.ietf.org/doc/html/rfc2631
6. https://datatracker.ietf.org/doc/html/rfc3394
7. https://datatracker.ietf.org/doc/html/rfc2315
8. https://datatracker.ietf.org/doc/html/rfc8032
9. https://docs.iden3.io/publications/pdfs/Baby-Jubjub.pdf